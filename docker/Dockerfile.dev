# Airホットリロード機能付き開発用Dockerfile
FROM golang:1.25-alpine

# ホットリロード用にAirをインストール
RUN go install github.com/air-verse/air@latest

# ヘルスチェック用にcurlをインストール
RUN apk add --no-cache curl

WORKDIR /app

# go modファイルをコピー
COPY go.mod ./

# go.sumが存在しない場合は初期化し、依存関係をダウンロード
RUN go mod download

# ソースコードと設定をコピー
COPY . .

# Air用のtmpディレクトリを作成
RUN mkdir -p tmp

EXPOSE 8080

# ホットリロード用にAirを使用
CMD ["air", "-c", "build/.air.toml"]